【ボイス再生機能拡張プラグイン】


■できること
・ボイス連動アニメーション
再生中の音声の音量に応じて口パク等のアニメーションを行います。
キャラクター差分パーツ機能と一緒に使います。
複数パーツの同時アニメーションには対応していません。

・ボイス再生中のBGM音量変更
ボイス再生中のBGM音量を変更できます。

・ボイスリピートボタン表示
ゲーム画面にボイスをリピート再生するボタンを表示します。

・バックログボイスリピートボタン表示
バックログ画面でボイスをリピート再生するボタンを表示します。

・ボイスファイル連番をゼロ埋め
ボイス自動再生用のボイスファイルの連番部分を「0001」のようにゼロ埋めで指定できるようにします。


■使い方
このテキストが入っているフォルダごと「data/others/plugin」フォルダに置きます。
それからfirst.ksとかに以下のように記述してください。
記述した時点から後述のタグが使用可能になります。

[plugin name=voiceplay_ex]
指定可能属性
len：ボイスファイル名の連番桁数を指定（「voice_0001.mp3」なら「4」を指定）

それから、make.ksに以下のタグを記述してください。
[voiceplay_ex_restore]


■使用可能タグ
vlanim_set：アニメーション定義開始
属性：
name（必須）：アニメーションさせるキャラクター名を指定します。
part（必須）：アニメーションさせるパーツ名を指定します。
id（必須）  ：アニメーションさせるパーツIDを指定します。

vlanim_frame：各フレーム定義
属性：
storage（必須）：パーツ画像のパスを指定します。画像はfgimageフォルダ下に配置します。
vol（必須）    ：パーツ画像を切り替える音量の下限値を数値で指定します。

vlanim_set_end：アニメーション定義終了
属性：
なし

vlanim_config：アニメーション設定
属性：
speed               ：画像を切り替える速度を指定します。単位はミリ秒です。初期値は50です。
bgm_volume          ：ボイス再生中にBGM音量を変更する場合はtrueを指定します。
bgm_volume_change   ：ボイス再生中のBGM音量を指定します。

vrepeat_config：ボイスリピートボタン設定
属性：
graphic     ：再生ボタンの画像を指定します。画像はimageフォルダ下に配置します。
x（必須）   ：再生ボタンの横位置を指定します。単位はピクセルです。
y（必須）   ：再生ボタンの縦位置を指定します。単位はピクセルです。

vrepeat：ボイスリピートボタン表示
属性：
name    ：発言者のnameを指定します。無指定の場合、現在の発言者となります。また、現在の発言者（[chara_ptext]に指定された名前）が空白の場合はボイスを再生しません。
num     ：ボイスのnumberを指定します。無指定の場合、直前のnumberとなります。
graphic ：再生ボタンの画像を個別に指定します。画像はimageフォルダ下に配置します。無指定の場合、vrepeat_configで指定したものになります。
x       ：再生ボタンの横位置を個別に指定します。単位はピクセルです。無指定の場合、vrepeat_configで指定したものになります。
y       ：再生ボタンの縦位置を個別に指定します。単位はピクセルです。無指定の場合、vrepeat_configで指定したものになります。

vrepeat_delete：ボイスリピートボタン消去
属性：
なし

logrepeat：バックログにボイスリピートボタン追加
属性：
なし

voiceplay_ex_restore：make.ks記述用
属性：
なし


■使用例
;キャラクター定義
[chara_new name=akane storage="chara/akane/body/body.png" jname="あかね"]
[chara_layer name=akane part=brow id=normal storage="chara/akane/brow/futsu.png"]
（中略）
;アニメーション定義
[vlanim_set name=akane part=mouth id=normal]
[vlanim_frame vol=5 storage="chara/akane/mouth/futsu_toji.png"]
[vlanim_frame vol=40 storage="chara/akane/mouth/futsu_aki.png"]
[vlanim_set_end]

;ボイス再生開始
[voconfig name=akane sebuf=1 vostorage="voice_{number}.mp3"]
[vostart]

;ボイスリピートボタン設定
[vrepeat_config graphic="button_voice.png" x=400 y=500]

#akane
;発言開始直前にリピートボタン表示
[vrepeat]
なにかのセリフ

;発言直後にバックログにボタン追加させる
[logrepeat]
[l][cm]

;改ページのタイミングでリピートボタン消去
[vrepeat_delete]


■使うときのコツ
・発言者をボイス再生バッファで判定しているので、ボイス再生バッファはキャラクターごとに分けてください。
・アニメーション定義するときは、4コマのアニメであれば音量設定は以下のように指定するといい感じになります。
1コマ目（閉じ）     音量：5
2コマ目（半開1）    音量：10
3コマ目（半開2）    音量：20
4コマ目（開き）     音量：40
閉じ画像の音量を0に指定すると、ほぼボイスなし（だけどごく小さい音が出ている）のときに口が半開きになってしまうことがあるので、最下限音量は5くらいを指定するとちょうどいいです。
全体的に音量指定は少し小さいかな？くらいの値を入れてもそれほど違和感はないと思います。

・[vrepeat]タグは発言するキャラ名の後に記述します。

・[logrepeat]タグは発言完了後に記述します。


■注意事項
開発中の仮公開版となります。
このプラグインを使用したことで生じたあらゆる問題について、製作者は責任を負いません。
不具合報告等は歓迎しております。制作者Twitterまでどうぞ。


■製作者
さくた（@skt_tyrano）
https://skt-pnt.netlify.app


■更新履歴
2022/05/22  ver.0.2.0α公開
・音量設定が0の場合でも口パクするように修正
・ボイス再生中にBGM音量を変更できる機能を追加

2022/02/11  ver.0.1.2α公開
・ロード時にループ効果音が再生されない不具合を修正

2021/12/04  ver.0.1.1α公開
・アニメーションしないパーツを指定していた場合にアニメーションが動かないよう修正

2021/01/15  ver.0.1α公開
・仮公開